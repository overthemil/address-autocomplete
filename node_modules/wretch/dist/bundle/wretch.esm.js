var r=function(){return(r=Object.assign||function(r){for(var t,e=1,o=arguments.length;e<o;e++)for(var n in t=arguments[e])Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r}).apply(this,arguments)};function t(r,t,e){if(e||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return r.concat(o||Array.prototype.slice.call(t))}var e=function(o,n,i){if(void 0===i&&(i=!1),!o||!n||"object"!=typeof o||"object"!=typeof n)return o;var s=r({},o);for(var u in n)n.hasOwnProperty(u)&&(n[u]instanceof Array&&o[u]instanceof Array?s[u]=i?t(t([],o[u],!0),n[u],!0):n[u]:"object"==typeof n[u]&&"object"==typeof o[u]?s[u]=e(o[u],n[u],i):s[u]=n[u]);return s},o={defaults:{},errorType:null,polyfills:{fetch:null,FormData:null,URLSearchParams:null,performance:null,PerformanceObserver:null,AbortController:null},polyfill:function(r,e){for(var o=void 0===e?{}:e,n=o.doThrow,i=void 0===n||n,s=o.instance,u=void 0!==s&&s,a=[],c=2;c<arguments.length;c++)a[c-2]=arguments[c];var f=this.polyfills[r]||("undefined"!=typeof self?self[r]:null)||("undefined"!=typeof global?global[r]:null);if(i&&!f)throw new Error(r+" is not defined");return u&&f?new(f.bind.apply(f,t([void 0],a,!1))):f}},n=function(r,t,e,o){if(!r.getEntriesByName)return!1;var n=r.getEntriesByName(t);return!!(n&&n.length>0)&&(e(n.reverse()[0]),o.clearMeasures&&o.clearMeasures(t),i.callbacks.delete(t),i.callbacks.size<1&&(i.observer.disconnect(),o.clearResourceTimings&&o.clearResourceTimings()),!0)},i={callbacks:new Map,observer:null,observe:function(r,t){if(r&&t){var e=o.polyfill("performance",{doThrow:!1});(function(r,t){return!i.observer&&r&&t&&(i.observer=new t((function(t){i.callbacks.forEach((function(e,o){n(t,o,e,r)}))})),r.clearResourceTimings&&r.clearResourceTimings()),i.observer})(e,o.polyfill("PerformanceObserver",{doThrow:!1}))&&(n(e,r,t,e)||(i.callbacks.size<1&&i.observer.observe({entryTypes:["resource","measure"]}),i.callbacks.set(r,t)))}}},s=function(r){this.error=r};function u(r){var t;return void 0===r&&(r={}),null===(t=Object.entries(r).find((function(r){return r[0].toLowerCase()==="Content-Type".toLowerCase()})))||void 0===t?void 0:t[1]}function a(r){return/^application\/.*json.*/.test(r)}var c=function(){function n(r,t,e,o,n,i){void 0===e&&(e=new Map),void 0===o&&(o=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),this._url=r,this._options=t,this._catchers=e,this._resolvers=o,this._middlewares=n,this._deferredChain=i}return n.factory=function(r,t){return void 0===r&&(r=""),void 0===t&&(t={}),new n(r,t)},n.prototype.selfFactory=function(e){var o=void 0===e?{}:e,i=o.url,s=void 0===i?this._url:i,u=o.options,a=void 0===u?this._options:u,c=o.catchers,f=void 0===c?this._catchers:c,l=o.resolvers,p=void 0===l?this._resolvers:l,h=o.middlewares,d=void 0===h?this._middlewares:h,y=o.deferredChain,v=void 0===y?this._deferredChain:y;return new n(s,r({},a),new Map(f),t([],p,!0),t([],d,!0),t([],v,!0))},n.prototype.defaults=function(r,t){return void 0===t&&(t=!1),o.defaults=t?e(o.defaults,r):r,this},n.prototype.errorType=function(r){return o.errorType=r,this},n.prototype.polyfills=function(t){return o.polyfills=r(r({},o.polyfills),t),this},n.prototype.url=function(r,t){if(void 0===t&&(t=!1),t)return this.selfFactory({url:r});var e=this._url.split("?");return this.selfFactory({url:e.length>1?e[0]+r+"?"+e[1]:this._url+r})},n.prototype.options=function(r,t){return void 0===t&&(t=!0),this.selfFactory({options:t?e(this._options,r):r})},n.prototype.query=function(r,t){return void 0===t&&(t=!1),this.selfFactory({url:f(this._url,r,t)})},n.prototype.headers=function(r){return this.selfFactory({options:e(this._options,{headers:r||{}})})},n.prototype.accept=function(r){return this.headers({Accept:r})},n.prototype.content=function(r){var t;return this.headers(((t={})["Content-Type"]=r,t))},n.prototype.auth=function(r){return this.headers({Authorization:r})},n.prototype.catcher=function(r,t){var e=new Map(this._catchers);return e.set(r,t),this.selfFactory({catchers:e})},n.prototype.signal=function(t){return this.selfFactory({options:r(r({},this._options),{signal:t.signal})})},n.prototype.resolve=function(r,e){return void 0===e&&(e=!1),this.selfFactory({resolvers:e?[r]:t(t([],this._resolvers,!0),[r],!1)})},n.prototype.defer=function(r,e){return void 0===e&&(e=!1),this.selfFactory({deferredChain:e?[r]:t(t([],this._deferredChain,!0),[r],!1)})},n.prototype.middlewares=function(r,e){return void 0===e&&(e=!1),this.selfFactory({middlewares:e?r:t(t([],this._middlewares,!0),r,!0)})},n.prototype.method=function(t,n,c){void 0===n&&(n={}),void 0===c&&(c=null);var f=this.options(r(r({},n),{method:t})),l=u(f._options.headers),p="object"==typeof c&&(!f._options.headers||!l||a(l));return function(r){var t=r._url,n=r._catchers,u=r._resolvers,a=r._middlewares,c=r._options,f=new Map(n),l=e(o.defaults,c),p=o.polyfill("AbortController",{doThrow:!1,instance:!0});!l.signal&&p&&(l.signal=p.signal);var h={ref:null,clear:function(){h.ref&&(clearTimeout(h.ref),h.ref=null)}},d=function(r){return function(t){return 0===r.length?t:1===r.length?r[0](t):r.reduceRight((function(e,o,n){return n===r.length-2?o(e(t)):o(e)}))}}(a)(o.polyfill("fetch"))(t,l),y=d.catch((function(r){throw new s(r)})).then((function(r){if(h.clear(),!r.ok){if("opaque"===r.type){var t=new Error("Opaque response");throw t.status=r.status,t.response=r,t}return r[o.errorType||"text"]().then((function(t){var e=new Error(t);throw e[o.errorType||"text"]=t,e.status=r.status,e.response=r,e}))}return r})),v=function(t){return t.catch((function(t){h.clear();var e=t instanceof s?t.error:t;if(t instanceof s&&f.has("__fromFetch"))return f.get("__fromFetch")(e,r);if(f.has(e.status))return f.get(e.status)(e,r);if(f.has(e.name))return f.get(e.name)(e,r);throw e}))},m=function(r){return function(t){return v(r?y.then((function(t){return t&&t[r]()})).then((function(r){return t?t(r):r})):y.then((function(r){return t?t(r):r})))}},b={res:m(null),json:m("json"),blob:m("blob"),formData:m("formData"),arrayBuffer:m("arrayBuffer"),text:m("text"),perfs:function(r){return d.then((function(t){return i.observe(t.url,r)})),b},setTimeout:function(r,t){return void 0===t&&(t=p),h.clear(),h.ref=setTimeout((function(){return t.abort()}),r),b},controller:function(){return[p,b]},error:function(r,t){return f.set(r,t),b},badRequest:function(r){return b.error(400,r)},unauthorized:function(r){return b.error(401,r)},forbidden:function(r){return b.error(403,r)},notFound:function(r){return b.error(404,r)},timeout:function(r){return b.error(408,r)},internalError:function(r){return b.error(500,r)},fetchError:function(r){return b.error("__fromFetch",r)},onAbort:function(r){return b.error("AbortError",r)}};return u.reduce((function(t,e){return e(t,r)}),b)}((f=c?p?f.json(c,l):f.body(c):f)._deferredChain.reduce((function(r,t){return t(r,r._url,r._options)}),f))},n.prototype.get=function(r){return this.method("GET",r)},n.prototype.delete=function(r){return this.method("DELETE",r)},n.prototype.put=function(r,t){return this.method("PUT",t,r)},n.prototype.post=function(r,t){return this.method("POST",t,r)},n.prototype.patch=function(r,t){return this.method("PATCH",t,r)},n.prototype.head=function(r){return this.method("HEAD",r)},n.prototype.opts=function(r){return this.method("OPTIONS",r)},n.prototype.replay=function(r){return this.method(this._options.method,r)},n.prototype.body=function(t){return this.selfFactory({options:r(r({},this._options),{body:t})})},n.prototype.json=function(r,t){var e=u(this._options.headers);return this.content(t||a(e)&&e||"application/json").body(JSON.stringify(r))},n.prototype.formData=function(r,t){return void 0===t&&(t=!1),this.body(l(r,t))},n.prototype.formUrl=function(r){return this.body("string"==typeof r?r:(t=r,Object.keys(t).map((function(r){var e=t[r];return e instanceof Array?e.map((function(t){return p(r,t)})).join("&"):p(r,e)})).join("&"))).content("application/x-www-form-urlencoded");var t},n}(),f=function(r,t,e){var n;if("string"==typeof t)n=t;else{var i=o.polyfill("URLSearchParams",{instance:!0});for(var s in t)if(t[s]instanceof Array)for(var u=0,a=t[s];u<a.length;u++){var c=a[u];i.append(s,c)}else i.append(s,t[s]);n=i.toString()}var f=r.split("?");return n?e||f.length<2?f[0]+"?"+n:r+"&"+n:e?f[0]:r};function l(r,e,n,i){return void 0===e&&(e=!1),void 0===n&&(n=o.polyfill("FormData",{instance:!0})),void 0===i&&(i=[]),Object.entries(r).forEach((function(r){var o=r[0],s=r[1],u=i.reduce((function(r,t){return r?"".concat(r,"[").concat(t,"]"):t}),null);if(u=u?"".concat(u,"[").concat(o,"]"):o,s instanceof Array)for(var a=0,c=s;a<c.length;a++){var f=c[a];n.append(u+"[]",f)}else!e||"object"!=typeof s||e instanceof Array&&e.includes(o)?n.append(u,s):null!==s&&l(s,e,n,t(t([],i,!0),[o],!1))})),n}function p(r,t){return encodeURIComponent(r)+"="+encodeURIComponent("object"==typeof t?JSON.stringify(t):""+t)}var h=c.factory;h.default=c.factory;export{h as default};
//# sourceMappingURL=wretch.esm.js.map
